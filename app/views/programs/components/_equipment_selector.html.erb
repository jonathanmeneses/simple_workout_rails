<!-- Equipment Selection Component -->
<div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
  <h3 class="text-lg font-medium text-gray-900 mb-3">Available Equipment</h3>
  <p class="text-sm text-gray-600 mb-4">Select your available equipment to filter exercise alternatives</p>
  
  <%= form_with url: program_path(@program), method: :get, local: false, 
                data: { 
                  turbo_frame: "program_content",
                  controller: "form"
                }, 
                class: "space-y-3" do |f| %>
    <%= f.hidden_field :view_mode, value: @view_mode %>
    <%= f.hidden_field :cycle, value: @selected_cycle %>
    
    <!-- Maintain substitution state -->
    <% @substitutions.each do |exercise_id, substitute_name| %>
      <%= f.hidden_field "substitutions[#{exercise_id}]", value: substitute_name %>
    <% end %>
    
    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
      <% Exercise::VALID_EQUIPMENT.each do |equipment| %>
        <label class="flex items-center">
          <%= f.check_box :equipment, 
                { multiple: true, checked: @selected_equipment&.include?(equipment) }, 
                equipment, "" %>
          <span class="ml-2 text-sm text-gray-700 capitalize"><%= equipment.humanize %></span>
        </label>
      <% end %>
    </div>
    
    <div class="flex gap-2 pt-2">
      <%= f.submit "Update Equipment", 
            class: "px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-colors" %>
      <%= link_to "Clear All", 
            program_path(@program, view_mode: @view_mode, cycle: @selected_cycle), 
            class: "px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",
            data: { turbo_frame: "program_content" } %>
    </div>
  <% end %>
  
  <% if @selected_equipment&.any? %>
    <div class="mt-3 pt-3 border-t border-gray-200">
      <p class="text-sm text-gray-600">Selected: 
        <span class="font-medium"><%= @selected_equipment.map(&:humanize).join(", ") %></span>
      </p>
    </div>
  <% end %>
</div>